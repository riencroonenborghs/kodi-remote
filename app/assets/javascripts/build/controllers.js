// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("kodiRemote.controllers", []);

  app.controller("AppController", [
    "$scope", "$interval", "Topbar", "$location", "Remote", function($scope, $interval, Topbar, $location, Remote) {
      var whatsPlaying;
      Topbar.setTitle("Kodi Remote");
      $scope.Topbar = Topbar;
      $scope.visit = function(path) {
        return $location.path(path);
      };
      $scope.playing = null;
      $scope.playerId = null;
      $scope.playPauseState = false;
      whatsPlaying = function() {
        return Remote.Player.activePlayers().then(function(data) {
          if (data.length > 0) {
            $scope.playerId = data[0].playerid;
            return Remote.Player.playing($scope.playerId).then(function(data) {
              return $scope.playing = data.item;
            });
          } else {
            return $scope.playing = null;
          }
        });
      };
      whatsPlaying();
      $interval(whatsPlaying, 5000);
      $scope.stop = function() {
        return Remote.Player.stop();
      };
      return $scope.playPause = function() {
        return Remote.Player.playPause($scope.playerId).then(function(data) {
          return $scope.playPauseState = !$scope.playPauseState;
        });
      };
    }
  ]);

  app.controller("PaginatedController", [
    "$scope", function($scope) {
      $scope.loading = false;
      $scope.list = [];
      $scope.page = 1;
      $scope.morePages = true;
      $scope.nextPage = function() {
        $scope.page += 1;
        return $scope.loadCurrentPage();
      };
      $scope.loadCurrentPage = function() {
        $scope.loading = true;
        return $scope.listService.index($scope.page).then(function(data) {
          var totalItemsInList;
          $scope.pushItemsOntoList(data);
          $scope.loading = false;
          totalItemsInList = data.limits.total;
          $scope.morePages = ($scope.page * $scope.listService.perPage) < totalItemsInList;
        });
      };
      return $scope.loadCurrentPage();
    }
  ]);

  app.controller("SearchController", [
    "$scope", function($scope) {
      $scope.search = {
        query: ""
      };
      return $scope.performSearch = function() {
        if ($scope.search.query.length > 2) {
          $scope.loading = true;
          return $scope.listService.search($scope.search.query).then(function(data) {
            $scope.setItemsOnList(data);
            $scope.morePages = false;
            $scope.loading = false;
          });
        } else {
          $scope.emptyList();
          $scope.page = 1;
          $scope.morePages = true;
          return $scope.loadCurrentPage();
        }
      };
    }
  ]);

}).call(this);
