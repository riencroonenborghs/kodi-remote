// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("kodiRemote.tvshows.controllers", []);

  kodiRemote.array = {
    inGroupsOf: function(_list, number) {
      var list, newList;
      list = _list.slice(0);
      newList = [];
      while (list.length > 0) {
        newList.push(list.splice(0, number));
      }
      return newList;
    }
  };

  app.controller("TvShowsController", [
    "$scope", "NavbarFactory", "TvShows", function($scope, NavbarFactory, TvShows) {
      $scope.tvShows = [];
      $scope.tvShowGroups = [];
      $scope.beforeSortLoad = function() {
        $scope.tvShows = [];
        return $scope.pagination.page = 1;
      };
      return $scope.load = function() {
        $scope.loading = true;
        return TvShows.all($scope.pagination.page, $scope.sortParams).then(function(data) {
          var i, len, ref, tvShow;
          $scope.loading = false;
          ref = data.data;
          for (i = 0, len = ref.length; i < len; i++) {
            tvShow = ref[i];
            $scope.tvShows.push(tvShow);
          }
          $scope.tvShowGroups = kodiRemote.array.inGroupsOf($scope.tvShows, 2);
          $scope.Navbar = new NavbarFactory;
          $scope.Navbar.addTitle("TV Shows (" + data.total + ")");
          $scope.paginationAfterLoad(TvShows.perPage, data.total);
        });
      };
    }
  ]);

  app.controller("SeasonsController", [
    "$scope", "$routeParams", "NavbarFactory", "TvShows", function($scope, $routeParams, NavbarFactory, TvShows) {
      var tvShowId;
      tvShowId = parseInt($routeParams.id);
      $scope.tvShow = null;
      $scope.seasons = [];
      $scope.seasonGroups = [];
      return TvShows.get(tvShowId).then(function(tvShowData) {
        $scope.tvShow = tvShowData.data;
        $scope.Navbar = new NavbarFactory;
        $scope.Navbar.addLink("/tvshows", "TV Shows");
        $scope.Navbar.addTitle($scope.tvShow.title);
        return $scope.tvShow.seasons().then(function(seasonsData) {
          $scope.seasons = seasonsData.data;
          return $scope.seasonGroups = kodiRemote.array.inGroupsOf($scope.seasons, 2);
        });
      });
    }
  ]);

  app.controller("EpisodesController", [
    "$scope", "$routeParams", "NavbarFactory", "TvShows", "Remote", function($scope, $routeParams, NavbarFactory, TvShows, Remote) {
      var seasonId, tvShowId;
      tvShowId = parseInt($routeParams.tvshowid);
      seasonId = parseInt($routeParams.id);
      $scope.tvShow = null;
      $scope.season = null;
      $scope.episodes = [];
      $scope.episodeGroups = [];
      TvShows.get(tvShowId).then(function(tvShowData) {
        $scope.tvShow = tvShowData.data;
        return $scope.tvShow.seasons().then(function(seasonsData) {
          var i, len, ref, results, season;
          ref = seasonsData.data;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            season = ref[i];
            if (season.seasonid === seasonId || season.season === seasonId) {
              $scope.season = season;
              $scope.Navbar = new NavbarFactory;
              $scope.Navbar.addLink("/tvshows", "TV Shows");
              $scope.Navbar.addLink("/tvshows/" + tvShowId + "/seasons", $scope.tvShow.title);
              $scope.Navbar.addTitle("Season " + season.season);
              results.push(season.episodes().then(function(episodeData) {
                $scope.episodes = episodeData.data;
                return $scope.episodeGroups = kodiRemote.array.inGroupsOf($scope.episodes, 2);
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        });
      });
      $scope.play = function(episode) {
        return Remote.playEpisode(episode.episodeid);
      };
      $scope.showPlayButton = function(event) {
        return $(event.currentTarget).find(".hoverable-video-avatar").find("button").show();
      };
      return $scope.hidePlayButton = function(event) {
        return $(event.currentTarget).find(".hoverable-video-avatar").find("button").hide();
      };
    }
  ]);

  app.controller("EpisodeController", [
    "$scope", "$routeParams", "Episodes", "NavbarFactory", function($scope, $routeParams, Episodes, NavbarFactory) {
      var episodeId;
      episodeId = parseInt($routeParams.id);
      $scope.episode = null;
      return Episodes.get(episodeId).then(function(episodeData) {
        $scope.episode = episodeData.data;
        $scope.Navbar = new NavbarFactory;
        $scope.Navbar.addLink("/tvshows", "TV Shows");
        $scope.Navbar.addLink("/tvshows/" + $scope.episode.tvshowid + "/seasons", $scope.episode.showtitle);
        $scope.Navbar.addLink("/tvshows/" + $scope.episode.tvshowid + "/seasons/" + $scope.episode.season + "/episodes", "Season " + $scope.episode.season);
        return $scope.Navbar.addTitle("Episode " + $scope.episode.episode + ": " + $scope.episode.title);
      });
    }
  ]);

}).call(this);
