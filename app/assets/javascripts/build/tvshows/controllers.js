// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("kodiRemote.tvshows.controllers", []);

  app.controller("TvShowsController", [
    "$scope", "Topbar", "TvShows", function($scope, Topbar, TvShows) {
      Topbar.setTitle("TV Shows");
      $scope.tvShows = [];
      $scope.beforeSortLoad = function() {
        $scope.tvShows = [];
        return $scope.pagination.page = 1;
      };
      return $scope.load = function() {
        $scope.loading = true;
        return TvShows.all($scope.pagination.page, $scope.sortParams).then(function(data) {
          var i, len, ref, tvShow;
          $scope.loading = false;
          ref = data.data;
          for (i = 0, len = ref.length; i < len; i++) {
            tvShow = ref[i];
            $scope.tvShows.push(tvShow);
          }
          Topbar.setTitle("TV Shows (" + data.total + ")");
          $scope.paginationAfterLoad(TvShows.perPage, data.total);
        });
      };
    }
  ]);

  app.controller("SeasonsController", [
    "$scope", "$routeParams", "Topbar", "TvShows", function($scope, $routeParams, Topbar, TvShows) {
      var tvShowId;
      tvShowId = parseInt($routeParams.id);
      $scope.tvShow = null;
      $scope.seasons = [];
      return TvShows.get(tvShowId).then(function(tvShowData) {
        $scope.tvShow = tvShowData.data;
        Topbar.setLink("/tvshows", $scope.tvShow.title);
        return $scope.tvShow.seasons().then(function(seasonsData) {
          return $scope.seasons = seasonsData.data;
        });
      });
    }
  ]);

  app.controller("EpisodesController", [
    "$scope", "$routeParams", "Topbar", "TvShows", "Remote", function($scope, $routeParams, Topbar, TvShows, Remote) {
      var seasonId, tvShowId;
      tvShowId = parseInt($routeParams.tvshowid);
      seasonId = parseInt($routeParams.id);
      $scope.tvShow = null;
      $scope.season = null;
      $scope.episodes = [];
      TvShows.get(tvShowId).then(function(tvShowData) {
        $scope.tvShow = tvShowData.data;
        return $scope.tvShow.seasons().then(function(seasonsData) {
          var i, len, ref, results, season;
          ref = seasonsData.data;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            season = ref[i];
            if (season.seasonid === seasonId) {
              $scope.season = season;
              Topbar.setLink("/tvshows/" + $scope.tvShow.tvshowid + "/seasons", "Season " + season.season);
              results.push(season.episodes().then(function(episodeData) {
                return $scope.episodes = episodeData.data;
              }));
            } else {
              results.push(void 0);
            }
          }
          return results;
        });
      });
      return $scope.play = function(episode) {
        return Remote.playEpisode(episode.episodeid);
      };
    }
  ]);

}).call(this);
