// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("kodiRemote.directives", []);

  app.directive("loadingScreen", [
    function() {
      return {
        restrict: "E",
        scope: {
          loading: "="
        },
        templateUrl: "app/views/loading.html"
      };
    }
  ]);

  app.directive("autoScroll", [
    "$compile", function($compile) {
      return {
        restrict: "A",
        link: function(scope, element, attrs) {
          var button, elementVisible, scrollHandler;
          button = $("<md-button>").attr("ng-click", "nextPage()").html("Next Page");
          $compile(button)(scope);
          element.append(button);
          elementVisible = function(elem) {
            var $elem, $window, docViewBottom, docViewTop, elemBottom, elemTop;
            $elem = $(elem);
            $window = $(window);
            docViewTop = $window.scrollTop();
            docViewBottom = docViewTop + $window.height();
            elemTop = $elem.offset().top;
            elemBottom = elemTop + $elem.height();
            return (elemBottom <= docViewBottom) && (elemTop >= docViewTop);
          };
          scrollHandler = function() {
            if (!scope.morePages) {
              button.hide();
            }
            if (elementVisible(button) && !scope.loading && scope.morePages) {
              return scope.nextPage();
            }
          };
          $(document).off("scroll", scrollHandler);
          $(document).on("scroll", scrollHandler);
          return scope.$watch("morePages", function() {
            if (scope.morePages) {
              button.show();
            }
            if (!scope.morePages) {
              return button.hide();
            }
          });
        },
        controller: ["$scope", function($scope) {}]
      };
    }
  ]);

  app.directive("avatarImage", [
    function() {
      return {
        restrict: "E",
        replace: true,
        scope: {
          avatar: "="
        },
        template: "<img src='{{avatar}}' class='md-avatar' />",
        controller: [
          "$scope", function($scope) {
            if ($scope.avatar) {
              $scope.avatar = decodeURIComponent($scope.avatar.replace("image://", ""));
              if ($scope.avatar.endsWith("/")) {
                return $scope.avatar = $scope.avatar.slice(0, -1);
              }
            }
          }
        ]
      };
    }
  ]);

  app.directive("circleAvatar", [
    function() {
      return {
        restrict: "E",
        replace: true,
        scope: {
          label: "="
        },
        template: "<div class='circle-avatar md-avatar'><span>{{initials}}</span></div>",
        controller: [
          "$scope", function($scope) {
            var parts;
            parts = $scope.label.split(" ");
            $scope.initials = parts[0][0];
            if (parts.length === 1) {
              return $scope.initials = parts[0][0] + parts[0][1];
            } else {
              return $scope.initials = parts[0][0] + parts[1][0];
            }
          }
        ]
      };
    }
  ]);

  app.directive("showRating", [
    function() {
      return {
        restrict: "E",
        replace: true,
        scope: {
          rating: "="
        },
        template: "<span ng-repeat='star in stars track by $index'><ng-md-icon icon='{{star}}' size='8' style='fill: grey;'></ng-md-icon></span>",
        controller: [
          "$scope", function($scope) {
            $scope.stars = ["star_outline", "star_outline", "star_outline", "star_outline", "star_outline"];
            if ($scope.rating >= 1) {
              $scope.stars[0] = "star_half";
            }
            if ($scope.rating >= 2) {
              $scope.stars[0] = "star";
            }
            if ($scope.rating >= 3) {
              $scope.stars[1] = "star_half";
            }
            if ($scope.rating >= 4) {
              $scope.stars[1] = "star";
            }
            if ($scope.rating >= 5) {
              $scope.stars[2] = "star_half";
            }
            if ($scope.rating >= 6) {
              $scope.stars[2] = "star";
            }
            if ($scope.rating >= 7) {
              $scope.stars[3] = "star_half";
            }
            if ($scope.rating >= 8) {
              $scope.stars[3] = "star";
            }
            if ($scope.rating >= 9) {
              return $scope.stars[4] = "star_half";
            }
          }
        ]
      };
    }
  ]);

  app.directive("runtime", [
    function() {
      return {
        restrict: "E",
        scope: {
          seconds: "="
        },
        template: "{{hours | number}}:{{minutes | number}}",
        controller: [
          "$scope", function($scope) {
            $scope.hours = $scope.seconds / 3600;
            $scope.runtime = $scope.runtime % 3600;
            return $scope.minutes = $scope.seconds / 60;
          }
        ]
      };
    }
  ]);

  app.directive("watchedIt", [
    function() {
      return {
        restrict: "E",
        scope: {
          model: "="
        },
        template: "<ng-md-icon icon='check_circle' size='12' style='fill: #6FA67B;' ng-if='model.playcount == 1' title='Watched it'></ng-md-icon>"
      };
    }
  ]);

}).call(this);
