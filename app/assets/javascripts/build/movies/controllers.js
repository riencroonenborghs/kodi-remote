// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("kodiRemote.movies.controllers", []);

  app.controller("MoviesController", [
    "$scope", "$controller", "Topbar", "Movies", "Remote", function($scope, $controller, Topbar, Movies, Remote) {
      Topbar.setTitle("Movies");
      $scope.listService = Movies;
      $scope.pushItemsOntoList = function(data) {
        var i, len, movie, ref;
        ref = data.movies;
        for (i = 0, len = ref.length; i < len; i++) {
          movie = ref[i];
          $scope.list.push(movie);
        }
        return Topbar.setTitle("Movies (" + data.limits.total + ")");
      };
      $controller("SortedPaginatedController", {
        $scope: $scope
      });
      $scope.setItemsOnList = function(data) {
        return $scope.list = data.movies;
      };
      $scope.emptyList = function() {
        return $scope.list = [];
      };
      $controller("SearchController", {
        $scope: $scope
      });
      $scope.play = function(movie) {
        return Remote.playMovie(movie.movieid);
      };
      return $scope.visitDetails = function(movieId) {
        return $scope.visit("/movies/" + movieId + "/details");
      };
    }
  ]);

  app.controller("MovieDetailsController", [
    "$scope", "$routeParams", "MoviesLoader", "Topbar", function($scope, $routeParams, MoviesLoader, Topbar) {
      var detailsLoader;
      $scope.movieId = parseInt($routeParams.id);
      detailsLoader = new MoviesLoader.DetailsLoader($scope);
      detailsLoader.afterCallback = function(data) {
        var castMember, i, len, ref, results;
        Topbar.setLink("/movies", $scope.movieDetails.label);
        ref = $scope.movieDetails.cast;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          castMember = ref[i];
          if (castMember.thumbnail) {
            castMember.avatar = decodeURIComponent(castMember.thumbnail.replace("image://", ""));
            results.push(castMember.avatar = castMember.avatar.slice(0, -1));
          } else {
            results.push(void 0);
          }
        }
        return results;
      };
      return detailsLoader.show($scope.movieId);
    }
  ]);

}).call(this);
